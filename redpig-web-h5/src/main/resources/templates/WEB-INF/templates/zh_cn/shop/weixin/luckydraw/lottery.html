<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<title></title>
	<link rel="stylesheet" href="$!cdnServer/resources/yingerMall/css/mui.min.css" />
	<link rel="stylesheet" href="$!cdnServer/resources/yingerMall/css/common.css" />
	<link rel="stylesheet" href="$!cdnServer/resources/yingerMall/css/layer.css" />
	<style rel="stylesheet">
		html,body{width: 100%;height: 100%;}
	</style>
</head>
<body>

<main style="min-height:100%;background: #7e2689;">
	<div>
		<img src="$!cdnServer/resources/yingerMall/images/bg-top.png" class="img-top" alt="幸运大抽奖" />
	</div>
	<div class="draw" id="lottery">
		<div class="draw-pos">
			<div class="draw-flex">
				<div class="draw-bg draw-bg-1">
					<div class="item lottery-unit lottery-unit-1 item-gifts">
						<div class="img">
							<img src="$!cdnServer/resources/yingerMall/images/img1.png" class="img1" alt="">
						</div>
					</div>
				</div>
				<td class="gap"></td>
				<div class="draw-bg draw-bg-1">
					<div class="item lottery-unit lottery-unit-2 item-smile">
						<div class="img">
							<img src="$!cdnServer/resources/yingerMall/images/img2.png" class="img2" alt="">
						</div>
					</div>
				</div>
				<td class="gap"></td>
				<div class="draw-bg draw-bg-1">
					<div class="item lottery-unit lottery-unit-3 item-gifts">
						<div class="img">
							<img src="$!cdnServer/resources/yingerMall/images/img3.png" class="img1" alt="">
						</div>
					</div>
				</div>
				<td class="gap"></td>
				<div class="draw-bg draw-bg-1">
					<div class="item lottery-unit lottery-unit-4 item-gifts">
						<div class="img">
							<img src="$!cdnServer/resources/yingerMall/images/img4.png" class="img1" alt="">
						</div>
					</div>
				</div>
			</div>
			<div>
				<div class="gap-2"></div>
			</div>
			<div class="draw-flex">
				<div class="draw-bg draw-bg-2">
					<div class="item lottery-unit lottery-unit-12 item-smile">
						<div class="img">
							<img src="$!cdnServer/resources/yingerMall/images/img2.png" class="img2" alt="">
						</div>
					</div>
				</div>
				<!--这个是为了让倒数第二个-->
				<div class="item lottery-unit lottery-unit-13 item-smile" style="position: fixed;left: 100000px;">
					<div class="img">
						<img src="$!cdnServer/resources/yingerMall/images/img2.png" class="img2" alt="">
					</div>
				</div>
				<div class="gap"></div>
				<div class="">
					<div class="draw-btn"></div>
				</div>
				<div class="gap"></div>
				<div class="draw-bg draw-bg-2">
					<div class="item lottery-unit lottery-unit-5 item-smile">
						<div class="img">
							<img src="$!cdnServer/resources/yingerMall/images/img5.png" class="img2" alt="">
						</div>
					</div>
				</div>
			</div>
			<!--<div>
                <div class="gap-2"></div>
            </div>-->
			<div class="draw-flex draw-ab">
				<div class="draw-bg draw-bg-3">
					<div class="item lottery-unit lottery-unit-11 item-gifts">
						<div class="img">
							<img src="$!cdnServer/resources/yingerMall/images/img3.png" class="img1" alt="">
						</div>
					</div>
				</div>
				<div class="gap"></div>
				<div class="">
					<!--<a class="draw-btn" href="javascript:"></a>-->
				</div>
				<div class="gap"></div>
				<div class="draw-bg draw-bg-3">
					<div class="item lottery-unit lottery-unit-6 item-gifts">
						<div class="img">
							<img src="$!cdnServer/resources/yingerMall/images/img1.png" class="img1" alt="">
						</div>
					</div>
				</div>
			</div>
			<!--<div>
                <div class="gap-2" colspan="5"></div>
            </div>-->
			<div class="draw-flex">
				<div class="draw-bg draw-bg-4">
					<div class="item lottery-unit lottery-unit-10 item-smile">
						<div class="img">
							<img src="$!cdnServer/resources/yingerMall/images/img5.png" class="img2" alt="">
						</div>
					</div>
				</div>
				<td class="gap"></td>
				<div class="draw-bg draw-bg-1">
					<div class="item lottery-unit lottery-unit-9 item-gifts">
						<div class="img">
							<img src="$!cdnServer/resources/yingerMall/images/img3.png" class="img1" alt="">
						</div>
					</div>
				</div>
				<td class="gap"></td>
				<div class="draw-bg draw-bg-1">
					<div class="item lottery-unit lottery-unit-8 item-smile">
						<div class="img">
							<img src="$!cdnServer/resources/yingerMall/images/img2.png" class="img2" alt="">
						</div>
					</div>
				</div>
				<td class="gap"></td>
				<div class="draw-bg draw-bg-4">
					<div class="item lottery-unit lottery-unit-7 item-gifts">
						<div class="img">
							<img src="$!cdnServer/resources/yingerMall/images/img4.png" class="img1" alt="">
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!--查看奖品-->
	<div class="gift-btn-box">
		<img src="$!cdnServer/resources/yingerMall/images/histor-gifts.png" class="gift-btn" id="watchHisGifts"/>
	</div>

	<!--规则-->
	<ul class="rule-ul">
		<li class="rule-li">1.活动有效时间：2018-06-23至2018-09-30</li>
		<li class="rule-li">2.发行方：艾美记</li>
	</ul>

</main>
<!--中奖记录-->
<div id="info" style="display: none;">
	<div class="has-modal">
		<a href="" class="close-btn"><img src="$!cdnServer/resources/yingerMall/images/modal-close.png"/></a>
		<!--中奖内容-->
		<div class="gift-con">
			<p class="cou-num"><span class="cum-type">抵用券:</span><span class="cum-unit">￥</span><span class="cum-price">100</span></p>
		</div>
	</div>
</div>

<script src="$!cdnServer/resources/yingerMall/js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="$!cdnServer/resources/yingerMall/js/layer.js" ></script>
<script type="text/javascript">
    var lottery = {
        index: -1, //当前转动到哪个位置，起点位置
        count: 0, //总共有多少个位置
        timer: 0, //setTimeout的ID，用clearTimeout清除
        speed: 20, //初始转动速度
        times: 0, //转动次数
        cycle: 50, //转动基本次数：即至少需要转动多少次再进入抽奖环节
        prize: -1, //中奖位置
        init: function(id) {
            if($('#' + id).find('.lottery-unit').length > 0) {
                var lottery = $('#' + id);
                var units = lottery.find('.lottery-unit');
                this.obj = lottery;
                this.count = units.length;
                console.log(this.index);
                lottery.find('.lottery-unit.lottery-unit-0' + this.index).addClass('active');
            };
        },
        roll: function() {
            var index = this.index;
            var count = this.count;
            var lottery = this.obj;
            $(lottery).find('.lottery-unit.lottery-unit-' + index).removeClass('active');
            index += 1;
            if(index > count - 1) {
                index = 0;
            };
            $(lottery).find('.lottery-unit.lottery-unit-' + index).addClass('active');
            this.index = index;
            return false;
        },
        stop: function(index) {
            this.prize = index;
            return false;
        }
    };

    function roll() {
        lottery.times += 1;
        lottery.roll(); //转动过程调用的是lottery的roll方法，这里是第一次调用初始化

        if(lottery.times > lottery.cycle + 11 && lottery.prize == lottery.index) {
            clearTimeout(lottery.timer);

            layer.open({
                type: 1,
                shadeClose: true,
                shade: false,
                maxmin: true, //开启最大化最小化按钮
                area: ['893px', '600px'],
                content: $("#info").html()
            });

            lottery.prize = -1;
            lottery.times = 0;
            click = false;
        } else {
            if(lottery.times < lottery.cycle) {
                lottery.speed -= 11;
            } else if(lottery.times == lottery.cycle) {
                var index = Math.random() * (lottery.count) | 0; //静态演示，随机产生一个奖品序号，实际需请求接口产生
                lottery.prize = index;
            } else {
                if(lottery.times > lottery.cycle + 11 && ((lottery.prize == 0 && lottery.index == 7) || lottery.prize == lottery.index + 1)) {
                    lottery.speed += 110;
                } else {
                    lottery.speed += 20;
                }
            }
            if(lottery.speed < 40) {
                lottery.speed = 40;
            };
            lottery.timer = setTimeout(roll, lottery.speed); //循环调用
        }
        return false;
    }

    var click = false;

    window.onload = function() {
        lottery.init('lottery');
        $('.draw-btn').on('click',function() {
            if(click) { //click控制一次抽奖过程中不能重复点击抽奖按钮，后面的点击不响应
                return false;

            } else {
                lottery.speed = 100;
                roll(); //转圈过程不响应click事件，会将click置为false
                click = true; //一次抽奖完成后，设置click为true，可继续抽奖
                return false;
            }
        });
    };
    /*查看奖品*/
    $("#watchHisGifts").on('click',function(){
        layer.open({
            type: 1,
            shadeClose: true,
            shade: false,
            maxmin: true, //开启最大化最小化按钮
            area: ['893px', '600px'],
            content: $("#info").html()
        });
    })
</script>
</body>
</html>
